generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model CreatorSnapshot {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  artistName  String @default("")
  cityArea    String @default("Chicago")
  genre       String @default("")
  vibeTags    String @default("")
  primaryGoal String @default("")

  spotify   String @default("")
  youtube   String @default("")
  instagram String @default("")
  tiktok    String @default("")
  website   String @default("")

  audienceSize     String @default("")
  emailList        String @default("")
  monthlyListeners String @default("")

  currentIncomeStreams String @default("")
  currentOffer         String @default("")
  priceRange           String @default("")

  upcomingRelease      String @default("")
  performanceFrequency String @default("")
  collabTargets        String @default("")

  biggestBlocker String @default("")

  diagnosticReports DiagnosticReport[]
}

model DiagnosticReport {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())

  snapshotId String?
  snapshot   CreatorSnapshot? @relation(fields: [snapshotId], references: [id], onDelete: SetNull)

  monetizationScore Int
  audienceScore     Int
  offerScore        Int
  momentumScore     Int
  clarityScore      Int

  topMovesJson Json
  notesJson    Json

  @@index([userId, createdAt])
}

model OfferBlueprint {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lane     String
  goal     String @default("")
  audience String @default("")
  vibe     String @default("")

  title        String @default("")
  promise      String @default("")
  pricing      Json
  deliverables Json
  funnel       Json
  scripts      Json

  executionRuns ExecutionRun[]
  dailyCheckIns OfferDailyCheckIn[]

  @@index([userId, createdAt])
}

model ExecutionRun {
  id        String   @id @default(cuid())
  userId    String
  offerId   String
  createdAt DateTime @default(now())

  channel String @default("")

  outreachCount Int @default(0)
  leadsCount    Int @default(0)
  callsBooked   Int @default(0)
  salesCount    Int @default(0)

  revenueCents Int @default(0)

  whatWorked String @default("")
  whatDidnt  String @default("")
  blockers   String @default("")
  notes      String @default("")

  iterationPlanJson Json

  offer OfferBlueprint @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([offerId, createdAt])
}

model OfferDailyCheckIn {
  id        String   @id @default(cuid())
  userId    String
  offerId   String

  // “Day bucket” normalized to the start of the day in America/Chicago (server enforces)
  day DateTime

  // 1–5
  energy Int @default(3)

  // How much did you actually execute today?
  minutesExecuted Int @default(0)

  // One key metric you care about today
  keyMetric      String @default("outreach") // "outreach" | "leads" | "sales" | "revenue" | "content" | "other"
  keyMetricValue Int    @default(0)

  // Reflection (tiny, not a journal)
  win      String @default("")
  blocker  String @default("")
  nextStep String @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  offer OfferBlueprint @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@unique([offerId, day])
  @@index([userId, day])
  @@index([offerId, day])
}

model AppEvent {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())

  name  String
  route String @default("")
  step  String @default("")

  offerId    String?
  snapshotId String?

  meta Json?

  @@index([userId, createdAt])
  @@index([userId, name, createdAt])
  @@index([userId, step, createdAt])
}

enum Plan {
  FREE
  SOUTH_LOOP
  RIVER_NORTH
  THE_LOOP
}

model Subscription {
  id String @id @default(cuid())

  userId String @unique
  plan   Plan   @default(FREE)

  stripeCustomerId     String? @unique
  stripeSubscriptionId String? @unique

  status           String @default("inactive")
  currentPeriodEnd DateTime?

  isLifetime Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([plan, status])
}