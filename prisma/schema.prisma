generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model CreatorSnapshot {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  artistName  String @default("")
  cityArea    String @default("Chicago")
  genre       String @default("")
  vibeTags    String @default("")
  primaryGoal String @default("")

  spotify   String @default("")
  youtube   String @default("")
  instagram String @default("")
  tiktok    String @default("")
  website   String @default("")

  audienceSize     String @default("")
  emailList        String @default("")
  monthlyListeners String @default("")

  currentIncomeStreams String @default("")
  currentOffer         String @default("")
  priceRange           String @default("")

  upcomingRelease      String @default("")
  performanceFrequency String @default("")
  collabTargets        String @default("")

  biggestBlocker String @default("")

  // âœ… Opposite relation for DiagnosticReport.snapshot
  diagnosticReports DiagnosticReport[]
}

model DiagnosticReport {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())

  // link to snapshot if you want traceability
  snapshotId String?
  snapshot   CreatorSnapshot? @relation(fields: [snapshotId], references: [id], onDelete: SetNull)

  // scores (0-100)
  monetizationScore Int
  audienceScore     Int
  offerScore        Int
  momentumScore     Int
  clarityScore      Int

  // main outputs
  topMovesJson Json
  notesJson    Json

  @@index([userId, createdAt])
}

model OfferBlueprint {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Inputs
  lane     String // "service" | "digital" | "membership" | "live" | "hybrid"
  goal     String @default("")
  audience String @default("")
  vibe     String @default("")

  // Outputs (saved blueprint)
  title        String @default("")
  promise      String @default("")
  pricing      Json
  deliverables Json
  funnel       Json
  scripts      Json

  // Iteration + optimization loop (Stage 1 Chicago)
  executionRuns ExecutionRun[]

  @@index([userId, createdAt])
}

model ExecutionRun {
  id        String   @id @default(cuid())
  userId    String
  offerId   String
  createdAt DateTime @default(now())

  // Where you ran it
  channel String @default("") // "instagram" | "tiktok" | "email" | "dm" | "live" | "ads" | "other"

  // What you did
  outreachCount Int @default(0) // DMs sent / emails sent / convos started
  leadsCount    Int @default(0) // people who raised hand / replied / opted-in
  callsBooked   Int @default(0) // consults booked
  salesCount    Int @default(0) // closed deals

  // Money
  revenueCents Int @default(0)

  // Qualitative notes
  whatWorked String @default("")
  whatDidnt  String @default("")
  blockers   String @default("")
  notes      String @default("")

  // Engine output (stored so you can compare iterations over time)
  iterationPlanJson Json

  offer OfferBlueprint @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([offerId, createdAt])
}

enum Plan {
  FREE
  SOUTH_LOOP
  RIVER_NORTH
  THE_LOOP
}

model Subscription {
  id String @id @default(cuid())

  userId String @unique
  plan   Plan   @default(FREE)

  // Stripe identifiers
  stripeCustomerId     String? @unique
  stripeSubscriptionId String? @unique

  // Status + timing (for recurring)
  status           String @default("inactive") // "active" | "trialing" | "past_due" | "canceled" | "inactive"
  currentPeriodEnd DateTime?

  // Lifetime flag (one-time purchase)
  isLifetime Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([plan, status])
}